---
interface Props {
  serverURL: string;
  lang?: string;
  dark?: string;
  emoji?: string[];
  meta?: string[];
  requiredMeta?: string[];
  reaction?: boolean;
  pageview?: boolean;
}

const {
  serverURL,
  lang = "zh-CN",
  dark = "html[data-theme-type='dark']",
  emoji = [
    "https://unpkg.com/@waline/emojis@1.1.0/weibo",
    "https://unpkg.com/@waline/emojis@1.1.0/bilibili",
  ],
  meta = ["nick", "mail", "link"],
  requiredMeta = [],
  reaction = true,
  pageview = true,
} = Astro.props;
---


<div id="waline-container"></div>

<link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline.css" />

<script
  type="module"
  is:inline
  define:vars={{ serverURL, lang, dark, reaction, pageview }}
>
  import { init } from "https://unpkg.com/@waline/client@v3/dist/waline.js";

  function initWaline() {
    const container = document.querySelector("#waline-container");
    if (!container) return;

    init({
      el: "#waline-container",
      serverURL,
      path: location.pathname,
      lang,
      dark,
      reaction,
      pageview,
    });
  }

  document.addEventListener("astro:page-load", initWaline);
</script>

<style is:global>
  /* 只作用于你这个容器 */
  #waline-container {
    margin-top: 1.75rem;
    padding-top: 1.25rem;
    border-top: 1px solid hsl(var(--bc) / 0.12);
  }

  /* Frosti/Prose 环境下容易把 Waline 的行高/间距挤坏，统一重置 */
  #waline-container,
  #waline-container * {
    line-height: normal;
  }

  /* 反应区（评分/表情）避免被挤到一行导致遮挡 */
  #waline-container .wl-reaction {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    align-items: center;
  }

  /* 卡片更像 Frosti 的圆角/底色 */
  #waline-container .wl-panel,
  #waline-container .wl-card {
    border-radius: 1rem;
    background: hsl(var(--b1));
    border: 1px solid hsl(var(--bc) / 0.12);
  }

  /* 头像对齐/大小 */
  #waline-container .wl-user-avatar,
  #waline-container .wl-avatar {
    width: 2.25rem;
    height: 2.25rem;
    border-radius: 9999px;
    overflow: hidden;
  }

  /* 输入框/按钮跟随主题 */
  #waline-container textarea,
  #waline-container input {
    background: hsl(var(--b1));
    border: 1px solid hsl(var(--bc) / 0.12);
    border-radius: 0.75rem;
  }
</style>


